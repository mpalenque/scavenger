<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover,user-scalable=no,maximum-scale=1.0,minimum-scale=1.0" />
  <title>QR Hunt - Find the Pieces</title>
  
  <!-- Google Fonts - Poppins para coincidir con Figma -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/index.css">
  <style>
    /* Page-specific tiny overrides only if needed */

    /* no overrides for now */
  </style>
  
  <script>
    (function(){
      try {
        const p = new URLSearchParams(location.search);
        window.__disableCamera = p.get('nocam') === '1';
        window.__lowPower = p.get('low') === '1';
        if (p.get('perf') === '1') localStorage.setItem('perfDebug','1');
        if (window.__lowPower) {
          document.documentElement.classList.add('low-power');
        }
      } catch (e) {}
    })();
  </script>
  
  <script>
    window.addEventListener('load', () => {
      console.log('Html5Qrcode available:', typeof Html5Qrcode !== 'undefined');
      
      if (typeof Html5Qrcode === 'undefined') {
        console.error('‚ùå html5-qrcode failed to load');
      }
    });
  </script>
</head>
<body>
  <div class="camera-container">
    <div id="qr-reader">
      <div id="camera-status">
        <div>üì∑ Camera Initializing...</div>
        <small style="opacity:0.7; margin-top:8px;">Please allow camera access</small>
        <button id="resume-camera-btn" style="display:none; margin-top:10px; padding:8px 16px; background:#00D4D4; color:white; border:none; border-radius:6px; font-size:0.8rem; cursor:pointer;">
          üîÑ Resume Scanning
        </button>
      </div>
    </div>
    
    <!-- Main Instructions - Solo el texto solicitado -->
    <div class="main-instructions">
      <p>Find QR codes to discover the puzzle pieces !</p>
    </div>
    
    <div class="qr-overlay" aria-hidden="true">
      <!-- QR Scanner Frame -->
      <div class="qr-target">
        <!-- Frame is now handled by CSS background -->
      </div>
      
      <div id="scan-flash" class="flash-overlay"></div>
      
      <!-- QR Detection Text Display - HIDDEN -->
      <div id="detected-qr" class="detected-qr-text" style="display: none;">
        Ready to scan QR codes...
      </div>
      
      <!-- Debug scanner status - HIDDEN -->
      <div id="scanner-debug" style="
        display: none;
        position: fixed;
        bottom: 20px;
        left: 20px;
        background: rgba(0,0,0,0.8);
        color: white;
        padding: 10px;
        border-radius: 5px;
        font-size: 12px;
        z-index: 1002;
        max-width: 300px;
        word-wrap: break-word;
      ">
        Scanner status: Initializing...
      </div>
    </div>
    
    <!-- Progress Indicators - EN LA PARTE INFERIOR como en Figma -->
    <div class="progress-container">
      <button class="progress-circle" data-piece="1" data-piece-id="piece_1">?</button>
      <button class="progress-circle" data-piece="2" data-piece-id="piece_2">?</button>
      <button class="progress-circle" data-piece="3" data-piece-id="piece_3">?</button>
      <button class="progress-circle" data-piece="4" data-piece-id="piece_4">?</button>
      <button class="progress-circle" data-piece="5" data-piece-id="piece_5">?</button>
      <button class="progress-circle" data-piece="6" data-piece-id="piece_6">?</button>
      <button class="progress-circle" data-piece="7" data-piece-id="piece_7">?</button>
    </div>
  </div>

  <!-- Test buttons for QR simulation -->
  <div class="test-buttons-container">
    <button class="test-btn" data-test-piece="1" title="Test QR 1">Q1</button>
    <button class="test-btn" data-test-piece="2" title="Test QR 2">Q2</button>
    <button class="test-btn" data-test-piece="3" title="Test QR 3">Q3</button>
    <button class="test-btn" data-test-piece="4" title="Test QR 4">Q4</button>
    <button class="test-btn" data-test-piece="5" title="Test QR 5">Q5</button>
    <button class="test-btn" data-test-piece="6" title="Test QR 6">Q6</button>
    <button class="test-btn" data-test-piece="7" title="Test QR 7">Q7</button>
  </div>

  <div class="ui-overlay">
    <div class="top-bar safe-area-top">
      <!-- Botones de control arriba a la derecha -->
      <button id="complete-form-btn" class="reset-btn" style="margin-right: 0.5rem; background: #35d3d3;">üèÜ Complete</button>
      <button id="reset-pieces-btn" class="reset-btn">üîÑ Reset</button>
    </div>
        <div class="bottom-panel safe-area-bottom">
      <!-- Hint Display - Centrado -->
      <div class="hint-display" id="hint-display">
  <div id="hint-text">Find QR codes to discover the puzzle pieces !</div>
        <small id="hint-detail" style="opacity: 0.8; display: block; margin-top: 0.25rem;"></small>
      </div>
      
      <!-- Hospital Rooms Button - Peque√±o a la derecha -->
      <div class="hospital-rooms-btn" id="hospital-rooms-btn">
        <div>Rooms</div>
      </div>
    </div>
  </div>

  <div id="qr-reader-results" class="hidden"></div>
  <div id="detected-text" class="hidden"></div>

  <div id="trivia-modal" class="modal-overlay hidden">
    <div class="modal-content">
      <h2 id="trivia-title">üß† Trivia Question</h2>
      <div id="trivia-question">Question will appear here</div>
      <ul id="trivia-options"></ul>
      <div id="trivia-feedback"></div>
      <div style="text-align: center;"><button id="trivia-close" class="btn hidden">Continue</button></div>
    </div>
  </div>

  <div id="final-form" class="modal-overlay hidden">
    <!-- Back link to return to game -->
    <a href="#" id="final-form-back" class="back-link" style="position: fixed; top: calc(env(safe-area-inset-top) + 12px); left: 12px; background: linear-gradient(135deg, #35D3D3, #20B2B2); border: 2px solid #20B2B2; color: #fff; border-radius: 24px; padding: 8px 12px; font-weight: 600; font-size: 0.85rem; text-decoration: none; z-index: 20000;">‚Üê Back to Game</a>
    <div class="modal-content" style="max-width: 850px; width: 95vw; max-height: 90vh; overflow: hidden;">
      <h2 style="margin-bottom: 1rem;">üéâ Scavenger Hunt Complete!</h2>
      <p style="margin-bottom: 1rem;">Congratulations, you've finished the AvaSure Symposium Scavenger Hunt! You've unlocked the Vicky Selfie filter and are entered to win a $250 airline gift card!</p>
      
      <!-- Links above the form -->
      <div style="margin-bottom: 1.5rem; text-align: center;">
        <p style="margin-bottom: 0.5rem;"><a id="selfie-link" href="filter/index.html" target="_blank" style="color:#35d3d3; font-weight:600; text-decoration:underline;">üéØ Open Vicky Selfie Filter</a></p>
        <p style="margin-bottom: 0;"><a id="linkedin-link" href="https://www.linkedin.com/groups/13183166/" target="_blank" style="color:#35d3d3; font-weight:600; text-decoration:underline;">üì± Join LinkedIn Group</a></p>
      </div>
      
      <!-- Embedded Google Form -->
      <div style="
        position: relative;
        width: 100%;
        height: 500px;
        border-radius: 15px;
        overflow: hidden;
        border: 3px solid #35d3d3;
        background: white;
        box-shadow: 
          0 0 0 1px rgba(53, 211, 211, 0.5),
          0 10px 30px rgba(53, 211, 211, 0.3);
        margin: 1rem 0;
      ">
        <iframe 
          src="https://docs.google.com/forms/d/e/1FAIpQLSezV-x7jX2h2wehpm1H__5SPp0vHBTrWs5wVNqd-da-hM-wxQ/viewform?embedded=true" 
          frameborder="0" 
          marginheight="0" 
          marginwidth="0"
          scrolling="yes"
          style="width: 100%; height: 100%; border: none; border-radius: 12px; background: white;">
          Loading form...
        </iframe>
      </div>
    </div>
  </div>

  <!-- Sponsor Match overlay (exact functionality of matching.html, no reload) -->
  <div id="sponsor-match-overlay" class="modal-overlay hidden" aria-hidden="true" style="z-index: 9999;">
    <!-- Back link behaves like close (no page reload) -->
    <a href="#" id="sm-exit" class="back-link">‚Üê Back</a>
    <div class="page">
      <div id="intro" class="main-instructions intro-hidden intro-center">Match each sponsor with the correct definition</div>

      <div class="card">
        <div id="sponsor" class="sponsor-pill">Loading‚Ä¶</div>
        <div id="options" class="options"></div>
      </div>

      <div id="progress" class="progress-container"></div>
    </div>

    <div id="toast" class="toast">Nice! 1/7 completed</div>

    <div id="final-modal" class="modal-overlay" style="display: none;">
      <div class="modal-content">
        <h2 style="margin:0 0 10px; font-family:'Poppins',sans-serif;">üéâ Congratulations!</h2>
        <p style="opacity:0.9; margin-bottom: 18px;">You matched all sponsors.</p>
        <a href="#" id="sm-return" class="btn">Return to main</a>
      </div>
    </div>
  </div>
  <!-- Scoped styles to replicate matching.css without global conflicts -->
  <style>
    /* Matching game styles scoped under #sponsor-match-overlay to avoid collisions */
    #sponsor-match-overlay { color: #fff; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Poppins', sans-serif; }
    #sponsor-match-overlay *, #sponsor-match-overlay *::before, #sponsor-match-overlay *::after { box-sizing: border-box; -webkit-user-select: none; user-select: none; -webkit-tap-highlight-color: transparent; -webkit-touch-callout: none; -webkit-text-size-adjust: 100%; touch-action: manipulation; }
    #sponsor-match-overlay input, #sponsor-match-overlay button, #sponsor-match-overlay select, #sponsor-match-overlay textarea { font-size: 16px !important; -webkit-appearance: none; appearance: none; }
    #sponsor-match-overlay .page { position: fixed; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; padding: calc(env(safe-area-inset-top) + 16px) 16px calc(env(safe-area-inset-bottom) + 16px); gap: 16px; }
    #sponsor-match-overlay .main-instructions { background: rgba(22, 37, 46, 0.9); border: 3px solid #00D4D4; border-radius: 40px; padding: 12px 16px; text-align: center; max-width: 320px; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); font-family: 'Poppins', sans-serif; font-weight: 600; font-size: 0.9rem; position: fixed; left: 50%; top: calc(env(safe-area-inset-top) + 16px); transform: translateX(-50%); z-index: 12; transition: top 480ms ease-in-out, transform 480ms ease-in-out, opacity 420ms cubic-bezier(0.22, 1, 0.36, 1); will-change: transform, opacity, top; opacity: 1; }
    #sponsor-match-overlay .main-instructions.intro-center { top: 50%; transform: translate(-50%, -50%) scale(1); }
    #sponsor-match-overlay .main-instructions.intro-hidden { opacity: 0; transform: translate(-50%, -50%) scale(0.96); }
    #sponsor-match-overlay .main-instructions.intro-visible { opacity: 1; }
    #sponsor-match-overlay .main-instructions.intro-attention { animation: introGlow 1100ms ease-out 3; box-shadow: 0 0 0 8px rgba(0, 212, 212, 0.28), 0 12px 28px rgba(0,0,0,0.38); }
    @keyframes introGlow { 0% { transform: translate(-50%, -50%) scale(1); box-shadow: 0 0 0 0 rgba(0, 212, 212, 0.25); } 50% { transform: translate(-50%, -50%) scale(1.035); box-shadow: 0 0 0 12px rgba(0, 212, 212, 0); } 100% { transform: translate(-50%, -50%) scale(1); box-shadow: 0 0 0 0 rgba(0, 212, 212, 0); } }
    #sponsor-match-overlay .card { flex: 1; width: 100%; max-width: 560px; display: flex; flex-direction: column; align-items: stretch; justify-content: center; gap: 16px; will-change: transform, opacity; }
    #sponsor-match-overlay .sponsor-pill { background: #ff9243; color: white; padding: 18px 22px; border-radius: 58.5px; text-align: center; font-weight: 800; font-size: 1.2rem; line-height: 1.1; font-family: 'Poppins', sans-serif; margin: 0 auto; max-width: 90vw; opacity: 0; transform: translateY(14px) scale(0.985); border: 3px solid rgba(53,211,211,0); box-shadow: 0 6px 14px rgba(0,0,0,0.25); transition: opacity 440ms cubic-bezier(0.22, 1, 0.36, 1), transform 440ms cubic-bezier(0.22, 1, 0.36, 1), border-color 320ms ease, box-shadow 320ms ease; will-change: opacity, transform, border-color, box-shadow; }
  #sponsor-match-overlay .sponsor-pill { display: inline-flex; align-items: center; gap: 10px; }
  #sponsor-match-overlay .sponsor-pill .sponsor-logo { height: 28px; width: auto; object-fit: contain; }
    #sponsor-match-overlay .sponsor-pill.is-visible { opacity: 1; transform: translateY(0) scale(1); }
    #sponsor-match-overlay .sponsor-pill.attention { border-color: #35d3d3; animation: sponsorAttention 1100ms ease-out; box-shadow: 0 0 0 4px rgba(53,211,211,0.45), 0 12px 26px rgba(255,146,67,0.35); }
    @keyframes sponsorAttention { 0% { box-shadow: 0 0 0 0 rgba(53,211,211,0.25), 0 6px 14px rgba(255,146,67,0.28); } 40% { box-shadow: 0 0 0 12px rgba(53,211,211,0), 0 10px 20px rgba(255,146,67,0.32); } 100% { box-shadow: 0 0 0 0 rgba(53,211,211,0), 0 6px 14px rgba(0,0,0,0.25); } }
    #sponsor-match-overlay .options { display: flex; flex-direction: column; gap: 12px; padding: 0 4px; }
    #sponsor-match-overlay .option-btn { width: 100%; padding: 16px 18px; background: #143940; color: white; border: 4px solid #35d3d3; border-radius: 58.5px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: opacity 260ms ease, transform 260ms ease, background 0.25s ease, border-color 0.25s ease, box-shadow 0.25s ease; font-family: 'Poppins', sans-serif; text-align: center; opacity: 0; transform: translateY(8px); position: relative; overflow: visible; }
    #sponsor-match-overlay .option-btn.is-visible { opacity: 1; transform: translateY(0); }
    #sponsor-match-overlay .option-btn:hover, #sponsor-match-overlay .option-btn:active { background: #35d3d3; border-color: #35d3d3; transform: translateY(-2px); }
    #sponsor-match-overlay .option-btn:disabled { opacity: 0.8; cursor: not-allowed; }
    #sponsor-match-overlay .option-btn.correct { background: #35d3d3 !important; border-color: #35d3d3 !important; color: #0b2a2a; text-shadow: 0 1px 0 rgba(255,255,255,0.35); transform: scale(1.03); }
    #sponsor-match-overlay .option-btn.correct.emphasis { box-shadow: 0 0 0 4px rgba(53,211,211,0.6), 0 0 22px rgba(53,211,211,0.55); }
    #sponsor-match-overlay .option-btn.correct.emphasis::after { content: ''; position: absolute; inset: -8px; border-radius: 60px; border: 3px solid rgba(53,211,211,0.85); animation: correctRing 950ms ease-out forwards; pointer-events: none; }
    @keyframes correctRing { 0% { transform: scale(0.9); opacity: 0.95; } 100% { transform: scale(1.25); opacity: 0; } }
    #sponsor-match-overlay .option-btn.incorrect { background: #143940 !important; border-color: #f44336 !important; }
    #sponsor-match-overlay .option-btn.animate-wrong { animation: shakeX 420ms ease; box-shadow: 0 0 0 3px #f44336, 0 0 18px rgba(244,67,54,0.55); }
    #sponsor-match-overlay .option-btn.animate-correct { animation: pulseGreen 950ms ease; box-shadow: 0 0 0 3px #35d3d3, 0 0 22px rgba(53,211,211,0.55); }
    #sponsor-match-overlay .sponsor-pill.correct-animate { animation: pulseGreen 950ms ease; }
    #sponsor-match-overlay .sponsor-pill.wrong-animate { animation: shakeX 420ms ease; }
    @keyframes shakeX { 0%,100% { transform: translateX(0); } 20% { transform: translateX(-6px); } 40% { transform: translateX(6px); } 60% { transform: translateX(-4px); } 80% { transform: translateX(4px); } }
    @keyframes pulseGreen { 0% { box-shadow: 0 0 0 0 rgba(53,211,211,0.6); } 70% { box-shadow: 0 0 0 12px rgba(53,211,211,0); } 100% { box-shadow: 0 0 0 0 rgba(53,211,211,0); } }
    #sponsor-match-overlay .progress-container { display: flex; justify-content: center; gap: 8px; position: fixed; bottom: calc(20px + env(safe-area-inset-bottom)); left: 50%; transform: translateX(-50%); z-index: 10; padding: 0 1rem; }
    #sponsor-match-overlay .progress-circle { width: 28px; height: 28px; border-radius: 50%; background: url('assets/empty-circle.svg') center/contain no-repeat; transition: all 0.2s ease; border: none; padding: 0; margin: 0; outline: none !important; display: flex; align-items: center; justify-content: center; color: #35d3d3; font-family: 'Poppins', sans-serif; font-weight: bold; font-size: 14px; }
    #sponsor-match-overlay .progress-circle.completed { background: url('assets/check-circle.svg') center/contain no-repeat; color: transparent; }
    #sponsor-match-overlay .progress-circle.flash-wrong { box-shadow: 0 0 0 3px #f44336, 0 0 14px rgba(244,67,54,0.6); }
    #sponsor-match-overlay .card.slide-out-left { animation: slideOutLeft 520ms ease forwards; }
    #sponsor-match-overlay .card.slide-in-right { animation: slideInRight 520ms ease forwards; }
    @keyframes slideOutLeft { 0% { transform: translateX(0); opacity: 1; } 100% { transform: translateX(-40%); opacity: 0; } }
    @keyframes slideInRight { 0% { transform: translateX(40%); opacity: 0; } 100% { transform: translateX(0); opacity: 1; } }
    /* The big celebratory correct overlay (global to avoid scoping issues) */
    .correct-overlay { position: fixed; left: 50%; top: 50%; transform: translate(-50%, -50%) scale(0.9); border-radius: 50%; width: 300px; height: 300px; display: flex; align-items: center; justify-content: center; background: radial-gradient(circle at 30% 30%, #45e0e0, #20b2b2); box-shadow: 0 8px 28px rgba(32,178,178,0.45), 0 0 0 6px rgba(53,211,211,0.35); opacity: 0; pointer-events: none; z-index: 20000; }
    .correct-overlay svg { width: 70%; height: 70%; display: block; }
    .correct-overlay::after { content: ''; position: absolute; inset: -8px; border-radius: 50%; border: 4px solid rgba(255,255,255,0.6); opacity: 0; }
    .correct-overlay.show { animation: popIn 650ms ease forwards; }
    .correct-overlay.show::after { animation: ringPulse 800ms ease-out 120ms forwards; }
    .correct-overlay.hide { animation: fadeOut 250ms ease forwards; }
    @keyframes popIn { 0% { transform: translate(-50%, -50%) scale(0.7); opacity: 0; } 50% { transform: translate(-50%, -50%) scale(1.08); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(1); opacity: 1; } }
    @keyframes ringPulse { 0% { transform: scale(0.85); opacity: 0.7; } 100% { transform: scale(1.25); opacity: 0; } }
    @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
    #sponsor-match-overlay .toast { position: fixed; left: 50%; transform: translateX(-50%); bottom: calc(72px + env(safe-area-inset-bottom)); background: linear-gradient(135deg, #FF8A50, #FF6B2C); border: 2px solid #FF6B2C; color: white; padding: 10px 16px; border-radius: 30px; font-weight: 700; font-family: 'Poppins', sans-serif; font-size: 0.95rem; box-shadow: 0 4px 12px rgba(255, 107, 44, 0.3); opacity: 0; pointer-events: none; transition: opacity 220ms ease; z-index: 15000; text-align: center; max-width: 90vw; }
    #sponsor-match-overlay .toast.show { opacity: 1; }
    #sponsor-match-overlay .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); padding: 1rem; }
    #sponsor-match-overlay .modal-content { background: rgba(26, 31, 46, 0.95); padding: 2rem; border-radius: 16px; max-width: 90vw; width: 420px; border: 2px solid rgba(45, 140, 255, 0.3); text-align: center; }
    #sponsor-match-overlay .btn { background: rgba(45, 140, 255, 0.95); color: #fff; border: none; padding: 0.8rem 1.2rem; border-radius: 10px; cursor: pointer; font-weight: 700; font-family: 'Poppins', sans-serif; }
    #sponsor-match-overlay .btn:hover { filter: brightness(1.05); }
    #sponsor-match-overlay .back-link { position: fixed; top: calc(env(safe-area-inset-top) + 12px); left: 12px; background: linear-gradient(135deg, #35D3D3, #20B2B2); border: 2px solid #20B2B2; color: #fff; border-radius: 24px; padding: 8px 12px; font-weight: 600; font-size: 0.85rem; text-decoration: none; z-index: 20000; }
    @media (min-width: 768px) {
      #sponsor-match-overlay .sponsor-pill { font-size: 1.4rem; }
      #sponsor-match-overlay .option-btn { font-size: 1.05rem; }
    }
  </style>

  <!-- Intro overlay -->
  <div id="intro-overlay" class="modal-overlay hidden">
    <div class="modal-content" style="max-width: 620px;">
      <h2>Welcome to the AvaSure Symposium AR Scavenger Hunt!</h2>
      <div style="margin-top:1rem; line-height:1.5;">
        <p>Over the next three days, you'll be on the hunt for seven hidden puzzle pieces. The game will guide you to each location, where you‚Äôll solve trivia, attend presentations, or get a demo at our booth. At each stop, you‚Äôll scan QR codes using the camera on your phone to collect your next piece.</p>
        <p style="margin-top:0.75rem;">Once you complete the puzzle, you'll unlock a special AR Vicky selfie filter and be entered into a raffle to win a $250 airline gift card!</p>
        <p style="margin-top:0.75rem;">It‚Äôs a great way to explore everything the symposium has to offer, so jump in, have some fun, and good luck on the hunt!</p>
      </div>
      <div style="text-align:center; margin-top:1.25rem;">
        <button id="intro-start-btn" class="btn" style="border-radius: 30px; padding: 0.8rem 1.4rem; font-weight:700;">Start!</button>
      </div>
    </div>
  </div>

  <!-- QR Detection Overlays -->
  <div id="qr-detection-overlay" class="qr-detection-overlay">
    <!-- Contenido ser√° establecido din√°micamente por JavaScript -->
  </div>
  
  <div id="qr-frame-overlay" class="qr-frame-overlay"></div>

  <!-- html5-qrcode local -->
  <script src="html5-qrcode.min.js"></script>
  
  <script type="module" src="js/data.js"></script>
  <script type="module" src="js/perf.js"></script>
  <script type="module" src="js/camera.js"></script>
  <script src="js/native-qr.js"></script>
  <script type="module" src="js/main.js"></script>
</body>
</html>
